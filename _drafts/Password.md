---
layout: post
title: パスワードの管理について
tags:
- security
- python
---
複雑なパスワードをいくつも覚えることは難しいため、良くないと分かっていても、とても覚えやすい単純なパスワードを使っていたり、同じパスワードを使いまわしたりしている人が多いであろう。この記事ではパスワードの管理について記す。

## パスワード設定の原則

パスワード設定方法には2つの原則がある。

1. 同じパスワードを使いまわさない。
2. 複雑なパスワードを使う。

1つ目の原則の目的は、[パスワードリスト攻撃](https://www.jpcert.or.jp/pr/2014/pr140004.html)を防ぐことにある。あるサイトに登録したパスワードがなんらかの理由で漏洩して、ユーザー名とパスワードのリストが出回ることがある。そのときに、複数のサイトに同じパスワードが設定されていると「あるサイトから漏えいしたパスワード」が、他のサイトでも使われることでログインに成功して被害が広がってしまう。パスワードの漏えいは必ずしも漏えいしたという事実がわかるとは限らないので、「漏えいしたことがわかってからパスワードを変えればいい」とするのは不十分である。

2つ目の原則には、「複雑なパスワード」といってもいろいろなレベルがあり、特に多くの人が使っている単純なパスワードは使うべきではない。[使用してはいけないパスワード、トップ 50](https://www.sophos.com/ja-jp/press-office/press-releases/2010/12/the-top-50-passwords-you-should-never-use.aspx)によれば、2010年のGawker 社の事件で盗まれたパスワードを解析したところ、トップ5はこのようなパスワードだった。

~~~
123456
pasword
12345678
lifehack
qwerty
~~~

その先にも、単純なパスワードが続いている。アカウントを盗もうとする攻撃者は、攻撃の成功率を高めるために、このような「よく使われるパスワード」を使ってサイトへの侵入を試みるため、単純なパスワードを使っていると破られる危険性が高まる。

「単語や人の名前などを使った覚えやすいパスワード」は、「攻撃者にとってはまぐれで当たりやすいパスワード」となるため、攻撃に対して弱いパスワードとなる。攻撃を成功しにくくするためには「複雑な覚えにくいパスワード」すなわち攻撃に対して「強い」パスワードを設定することとなる。なるべく文字数は長く、アルファベット（小文字、大文字）、数字、記号など、使う文字の種類は増やす方が攻撃は成功しにくいため、より強いパスワードとなる。

## パスワードの管理方法

このように「強いパスワード」を「サイトごとにばらばらに」設定すると、人間の記憶力ではそのパスワードは覚えられないので、パスワードを管理するための補助手段が必要となる。そのための3つの方法を記す。記載する順番としては、誰でも簡単に実行できる方法から、よりITに詳しい人向けの方法へと進めていくため、適宜「自分にとって便利である」と思われる方法を選択し、さらに自分なりの工夫を加えると良いであろう。

また、ここに書かれているような方法でパスワードを万全に管理していても、たとえば[フィッシング](https://ja.wikipedia.org/wiki/%E3%83%95%E3%82%A3%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0_(%E8%A9%90%E6%AC%BA))にかかればパスワードが盗まれてしまう。ここに書かれていることは必ずしもセキュリティ対策の「すべて」ではないことも認識しておく必要がある。

なお、このページではパスワードを管理するソフトウェアを使用する方法については除外する。その理由としては、それらのソフトは開発元は信用できるか、開発元に悪意がなくてもソフトウェアの不具合によってパスワードが漏えいしないか、ソフトの開発が止まって突然ソフトが使えなくならないか、というような懸念もあり、自ら特定のソフトを信頼して使うのは良いとしても、他人に勧めることはできないと考えているためである。

### (1) 紙のメモ

「パスワードは紙に書いてはいけない」と、昔はよく言われていた。その紙を他の人から見えるところに置いておけば、簡単にパスワードを盗まれてしまうためである。一方で、紙に書いた情報は離れた場所にいる攻撃者からネットワーク経由で盗まれる心配はないという点においては、ファイルで保存する方法と比べて優れている。この方法の安全性を高めるためには、「他人から見られにくい場所に紙を保管する」だけでなく「もし見られてしまってもパスワードを容易に推測できないようにする」といった対策が望ましい。そのためには、紙に記載したパスワードから本物のパスワードへの変換規則を作り、それを記憶する。たとえば、 ```yaQ``` のような決められた文字を末尾に追加する、といったような変換規則が考えられる。すなわち、紙には

~~~
○×銀行
ID seki 
パスワード xTL2WLGz0P
~~~

のように書いておき、```xTL2WLGz0P``` に決められた文字 ```yaQ``` を追加して ```xTL2WLGz0PyaQ``` というパスワードとする。この「yaQ」という文字は他のサイトにも共通のものとしておけば、この程度の長さであれば記憶可能である。このようにすれば、たとえば家族がその紙を見てこっそりとログインを試みても成功しない。

紙の保管で大変なのは紛失対策である。大きめのノートに記して決められた場所に保管する、持ち歩かない（持ち歩くと紛失の危険性が高くなる）、あるいはコピーして2箇所以上に保管する、といった対策が考えられる。

### (2) パスワード付き電子ファイル

パスワードなどのアカウント情報をパソコンやスマホなどに電子的に記録することで、たとえばウィルスに感染してその情報を読み取られるという危険性が生じる。その対策をする必要があるという前提で、アカウント情報をどのように電子的に記録するのかを考える。

アカウント情報が書かれているファイルを「そのまま読める状態で」保存しておくことはリスクが高く、ファイルを暗号化して、解読用のパスワードを入力しなければ読むことができないようにすることが望ましい。[IPAが例示する方法](http://www.ipa.go.jp/security/txt/2013/08outline.html)の中にもこの方法が書かれている。「パスワード付き電子ファイル」を作るためには、パスワード付き圧縮ファイルを使う方法や、[GPG](https://ja.wikipedia.org/wiki/GNU_Privacy_Guard)のような暗号化のためのソフトウェアを使う方法、暗号化ディスクイメージファイルを作成する方法などがある。

### (3) 電子ファイルとハッシュ関数

「記憶した共通のマスターパスワード」と「電子ファイルに保存したサイト固有のパスワードの種」から、決められた[ハッシュ関数](https://ja.wikipedia.org/wiki/%E6%9A%97%E5%8F%B7%E5%AD%A6%E7%9A%84%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E9%96%A2%E6%95%B0)でパスワードを生成する、という方法である。これは(2)と似て非なるものである。

[SuperGenPass](https://chriszarate.github.io/supergenpass/) は、「サイト固有のパスワードの種」を、公開された情報である「サイトのドメイン名」として（このソフトの作者は、マスターパスワードを強くすればそれで十分な安全性があると考えている）、JavaScript やブックマークレットを使って使いやすくしたものである。Mobile 版を試してみると、使い方が分かる。また、マスターパスワードを強化するために自分だけがわかるなぞなぞを使う [EpisoPass](https://episopass.com/) というシステムもある。

電子ファイルが漏えいして、電子ファイルを入手した攻撃者が「間違ったマスターパスワード」を入力したときに、生成されるパスワードが正しいか間違っているかが「実際にオンラインでログインを試行しないとわからない」という点が、この方法が(2)とは決定的に異なる点である。すなわち、(2)の方法では、オフラインでマスターパスワードが正しいか間違っているかがわかってしまうために、CPUの実行速度で短い時間で数多くの試行が可能であるため総当たり攻撃が成立しやすい。一方で、この方法ではサイトがパスワードの誤入力を許容する頻度の限界によって制限されるため、同じ時間内で試行できる回数が(2)と比べて桁違いに少ない。パスワード入力ミスを一定回数繰り返すとロックがかかるシステムも多い。

この方法を実現する簡単な[パスワード生成スクリプト](https://gist.github.com/sekika/4d793e598749a63cdbdc4c19e59d141b) (Python 3) を公開する。コメントに記されているように、サイト固有のパスワードの種を直接スクリプトの中に書き込んである。著者は、自分専用のスクリプトはすべてプライベート Git リポジトリで管理して、そのディレクトリにパスを通して使用しているが、このような自分専用のパスワード生成スクリプトもそこで管理をしている。プログラミングができる人であれば、自分が使いやすい言語でこのようなスクリプトを書いてメンテをすると、いろいろな自由度が高くて良いであろう。

## 二要素認証

いずれの方法でパスワードを管理したとしても、さらに安全性を高めるためには、パスワード以外の認証方法を併用することが有効である。ここでは、[多要素認証](https://ja.wikipedia.org/wiki/%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC)の1つである携帯・スマホによる二要素認証について記す。これは、「ユーザー名とパスワード」という従来のログイン手段に加えて「そのときに持っているもの（携帯・スマホ）」によって認証をする、というものである。

たとえば、携帯の番号を登録しておいて、パスワードを入力すると、携帯・スマホにテキストメッセージ([SMS](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9))で確認コード（ワンタイムパスワード）が送られてきて、その番号を入力してはじめてログインできる。その番号はそのとき1回限りのものなので、そのときに携帯・スマホを「持っている」人でないとログインできない、というしかけである。二要素認証には、主として

- 携帯・スマホへの SMS や音声通話を使うもの
- 確認コード（ワンタイムパスワード）表示専用の小型端末（[トークン](https://www.google.co.jp/search?hl=ja&q=%E3%83%AF%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89+%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3&tbm=isch)）を使うもの
- モバイルアプリを使うもの（[Google 認証システムの仕組み](/2016/03/26/GoogleAuthenticator/)参照）

がある。ここで、たとえばモバイルアプリで二要素認証を設定すると、そのモバイルアプリが使えなくなったとき（スマホの紛失など）にログインできなくなるので、SMSでも二要素認証ができるようにする、バックアップコードを印刷する、などといった対策が必要となる。SMS であれば、スマホを紛失しても同じ電話番号で新しいスマホを取得すれば、SMS を受け取ることは可能であろう。
