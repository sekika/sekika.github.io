---
layout: math
title: Rust による円周率計算プログラム
tags:
- math
- rust
---
円周率を任意桁数計算するプログラムをRustで作成した。

## 計算方法

ガウス・ルジャンドルのアルゴリズムを元にしたアルゴリズム、すなわち初期値を

$$a_0 =1, b_0 =\frac{1}{\sqrt{2}}, t_0 =\frac{1}{4}, p_0 =1$$

反復式を

$$
\begin{align}
a_{n+1} &=\frac{a_n +b_n}{2} \\
b_{n+1} &=\sqrt{a_n b_n} \\
t_{n+1} &=t_n -p_n(a_n - a_{n+1})^2 \\
p_{n+1} &= 2p_n
\end{align}
$$

とすると、円周率πは

$$\pi \approx \frac{(a+b)^2}{4t}$$

と近似される、というアルゴリズムにより円周率を任意桁数計算する。多倍長計算の[rug crate](https://crates.io/crates/rug)を使った。

ただし、10億桁を超すような計算になると、メモリが十分に確保されていなければ計算速度が落ちる。金田康正と[高橋大介](https://scholar.google.co.jp/citations?user=eITKfuQAAAAJ)は、1998年にガウス・ルジャンドル法によって[分散メモリ型並列計算機による円周率の515億桁計算](https://tsukuba.repo.nii.ac.jp/records/37234)をした。さらに計算精度を上げるには、Chudnovsky の公式などが使われるようだ。以下に、いくつかの参考サイトを示す。

- [世界記録は31兆桁！ 日本人も活躍する円周率「π」計算の最先端](https://gendai.media/articles/-/84616) - 柳谷晃, 2021/7/17
- [円周率を求める公式・アルゴリズム](https://xn--w6q13e505b.jp/formula/) - 円周率.jp
- [Chudnovsky の公式を用いた円周率の計算用メモ](https://qiita.com/peria/items/c02ef9fc18fb0362fb89) - Peria Peria
- [円周率の歴史](https://ja.wikipedia.org/wiki/%E5%86%86%E5%91%A8%E7%8E%87%E3%81%AE%E6%AD%B4%E5%8F%B2) - Wikipedia

## 使い方
[Rustをインストール](https://doc.rust-jp.rs/book-ja/ch01-01-installation.html)してcargoが使えるようになったら、次のように[compute-pi crate](https://crates.io/crates/compute-pi)をインストールする。

```
cargo install compute-pi
```

すると

```
compute-pi <桁数>
```

で、その桁数の円周率が表示される。たとえば、

```
compute-pi 10
```

とすると

```
Pi to 10 decimal places: 3.1415926535
```

と表示され、

```
compute-pi 1000
```

とすると

```
Pi to 1000 decimal places: 3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989
```

と表示される。クレートを読み込んで Rust プログラムの中から関数を使うこともできる。[ドキュメント](https://crates.io/crates/compute-pi)参照。

## 計算時間
M1 Mac mini (2020)での計算。

```
> time compute-pi 1000
Pi to 1000 decimal places: 3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989

________________________________________________________
Executed in    3.02 millis    fish           external
   usr time    1.22 millis  390.00 micros    0.82 millis
   sys time    1.99 millis  337.00 micros    1.65 millis
```
この Executed in の時間を記録した。

- 1000桁: 3.02 ミリ秒
- 1万桁: 12.50 ミリ秒
- 10万桁: 0.146 秒
- 100万桁: 1.76 秒
- 1000万桁: 34.2 秒
- 1億桁: 498.80 秒 (8.3 分)
- 2億桁: 16.8 分)

なお、1億桁表示したときの最後の10桁は
0187751592
であり、[このページの結果 (130 MB)](https://archive.org/stream/Pi_to_100000000_places/pi.txt)と一致することを確認した。 
